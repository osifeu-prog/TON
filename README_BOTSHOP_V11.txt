
BOTSHOP – גרסת V11 (סטטיסטיקת START + תפריט אדמין + מסך פתיחה מעודכן)
====================================================================

מה חדש בגרסה הזו?
------------------
1. לוגים אמינים יותר לכל /start:
   * כל לחיצה על /start נרשמת כאירוע ב-referrals.json (start_events_total, starts_by_user, last_start_at).
   * נשלחת הודעת לוג גם ל-LOGS_GROUP_CHAT_ID וגם ל-ADMIN_ALERT_CHAT_ID (אם הוגדרו).

2. מסך פתיחה חדש ומשופר:
   * טקסט מפורט בשלושה–ארבעה חלקים, כפי שביקשת.
   * תמונת פתיחה מהנתיב: assets/start_banner.jpg (או מה-START_IMAGE_PATH ב-ENV אם הוגדר).
   * מקלדת עם כפתורים:
     - 🏦 תשלום בהעברה בנקאית (מציג פרטי חשבון הבנק של קאופמן צביקה).
     - 💎 תשלום ב-TON (מציג את כתובת הטון שלך).
     - 🧩 איך להגדיר ארנק TON (הסבר שלב-אחר-שלב).
     - ℹ️ מה אני מקבל בקהילה? (הסבר ערכי ותדמיתי).

3. תפריט אדמין חדש – /admin:
   * נגיש רק למי ש-id שלו מופיע במשתנה ADMIN_OWNER_IDS.
   * מציג:
     - מספר משתמשים רשומים (total_users מתוך referrals.json).
     - מספר לחיצות /start מצטבר (start_events_total).
     - זמן /start אחרון (last_start_at).
   * בנוסף מציג רשימת פקודות עיקריות של הבוט.

4. Healthz מורחב לדיבוג:
   * /health – כמו קודם (מצב כללי).
   * /healthz – מחזיר:
     - telegram_ready – האם הבוט הצליח לבצע getMe.
     - db_connected – האם החיבור ל-DB הצליח (אם קיים מודול db עם get_session).
     - details – כולל bot_username, bot_id, admin/chat ids ועוד.

מה לעדכן ב-Railway?
--------------------
חובה:
1. BOT_TOKEN – הטוקן של @Buy_My_Shop_bot.
2. WEBHOOK_URL – למשל:
   https://botshop-production.up.railway.app/webhook
3. ADMIN_OWNER_IDS – לדוגמה:
   224223270
   (אפשר גם רשימה עם פסיקים/רווחים, המערכת תאתר את כל המספרים).

מומלץ:
4. ADMIN_ALERT_CHAT_ID – chat_id של קבוצת האדמינים/לוגים (הבוט חייב להיות חבר בקבוצה).
5. LOGS_GROUP_CHAT_ID – אם רוצים קבוצה נפרדת ללוגים; אם לא, אפשר להשאיר ריק והשדה ישתמש ב-ADMIN_ALERT_CHAT_ID.
6. START_IMAGE_PATH – נתיב יחסי לתמונה, למשל:
   assets/start_banner.jpg

איך לעדכן את ה-chat_id של קבוצת הלוגים?
----------------------------------------
1. הוסף את הבוט לקבוצה.
2. שלח לקבוצה הודעה כלשהי.
3. השתמש בבוט @RawDataBot או בכלי אחר כדי לקבל את ה-chat_id של הקבוצה.
   (זה ייראה כמו -1001748319682).
4. ב-Railway:
   - הגדר ADMIN_ALERT_CHAT_ID לערך הזה, לדוגמה:
     -1001748319682
   - אם תרצה, הגדר גם LOGS_GROUP_CHAT_ID לאותו ערך או לקבוצה אחרת.

הערה: בקוד החדש יש פונקציית _parse_chat_id שמוציאה את המספר מתוך מחרוזת,
גם אם הכנסת בטעות תווים נוספים מסביב.

איך לפרוס את הגרסה החדשה?
--------------------------
1. מחק את כל הקבצים הקיימים בתיקיית הפרויקט המקומית של BOTSHOP (או גבה אותם).
2. חלץ את קובץ ה-zip החדש לתיקייה.
3. ודא שהתיקייה assets/start_banner.jpg קיימת ושם התמונה מתאים.
4. דחוף את הקוד ל-GitHub (אם אתה עובד עם Git),
   או העלה את הקבצים ישירות ל-Railway אם אתה מעדיף.
5. ב-Railway:
   - ודא שכל משתני הסביבה (ENV) מוגדרים כנדרש.
   - לחץ Redeploy לשירות botshop.

בדיקות מהירות אחרי פריסה:
-------------------------
1. בקר ב:
   https://botshop-production.up.railway.app/healthz
   ודא שאתה מקבל JSON עם:
   - "status": "ok"
   - "telegram_ready": true
   - "db_connected": true או false (תלוי אם יש DB)
   - details עם bot_username וכו'.

2. פתח את הבוט בטלגרם:
   - שלח /start כמה פעמים מחשבונות שונים (או לפחות פעמיים מאותו חשבון).
   - ודא:
     * שאתה מקבל את כל 4 ההודעות הטקסטואליות.
     * שהתמונה מוצגת (אם קיים קובץ).
     * שהכפתורים מופיעים:
       🏦 תשלום בהעברה בנקאית
       💎 תשלום ב-TON
       🧩 איך להגדיר ארנק TON
       ℹ️ מה אני מקבל בקהילה?

3. לחץ על כל אחד מהכפתורים:
   - ודא שאתה מקבל את ההסברים הנכונים.

4. כנס כ-ADMIN ושלח /admin:
   - ודא שאתה רואה את הסטטיסטיקות (total_users, start_events_total, last_start_at).

5. בדוק בקבוצת הלוגים (ADMIN_ALERT_CHAT_ID / LOGS_GROUP_CHAT_ID):
   - כל /start אמור לייצר הודעה חדשה עם פרטי המשתמש וה-referrer.

אם משהו לא ברור או תרצה להרחיב את פאנל האדמין (למשל להוסיף /broadcast, /export, /debug),
אפשר להמשיך משגרה זו ולהוסיף פונקציות נוספות.
