<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TON Tip Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    body{font-family:Rubik,system-ui,'Segoe UI',Arial}
    .glass{backdrop-filter:blur(12px)}
  </style>

  <!-- TON Connect UI (רק להתחברות + החזרה לאתר שלך) -->
  <script type="module">
    import { TonConnectUI } from 'https://esm.run/@tonconnect/ui@2.2.0';
    // שים לב: לא מבצעים תשלום דרך הארנק – רק התחברות/זיהוי למי שירצה
    window.__tonConnectUI = new TonConnectUI({
      manifestUrl: 'https://tonfront.onrender.com/tonconnect-manifest.json',
      buttonRootId: 'ton-connect',
      uiPreferences: { theme: 'SYSTEM' },
      actionsConfiguration: {
        // כשלחוזרים מהארנק – חוזרים לאתר שלך
        returnStrategy: 'https://tonfront.onrender.com',
        // ואם מגיעים מתוך Mini App של טלגרם – חזרה לבוט שלך
        twaReturnUrl: 'https://t.me/hbdcommunity_bot'
      }
    });
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100">
  <!-- HEADER -->
  <header class="p-4 sm:p-6">
    <div class="max-w-4xl mx-auto flex items-center justify-between gap-3">
      <div class="text-xl sm:text-2xl font-extrabold tracking-tight">TON Tip Store</div>
      <a id="communityLinkTop"
         class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 transition shadow w-auto">
        הצטרפות לקהילה
      </a>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-4xl mx-auto px-4 sm:px-6">
    <div class="grid gap-6 sm:grid-cols-2 items-start">
      <!-- מידע / פרימיום -->
      <section class="p-5 sm:p-6 rounded-3xl bg-white/60 glass shadow-lg">
        <img
          src="/frontendassets/536279550_10237941019841362_2777380265588054892_n.jpg"
          onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1557821552-17105176677c?q=80&w=1470&auto=format&fit=crop';"
          class="rounded-2xl w-full h-48 sm:h-56 md:h-64 object-cover mb-4" alt="hero" />
        <h1 class="text-2xl sm:text-3xl font-extrabold mb-2">מידע פרימיום / מוצר דיגיטלי</h1>
        <p class="text-gray-700 leading-relaxed">
          כהאם ידעתם שכל עוד אתם משתמשים בארנק טלגרם הכספים שלכם המצויים בו מוגדרים כהשקעה לכל דבר ועל כן לא מחוייבים במס בפועל?
        </p>

        <!-- בלוק טקסט  -->
        <section class="mt-5 p-4 rounded-2xl bg-gray-50 text-gray-800">
          <h3 class="font-bold mb-2">על התוכן / היוצר</h3>
          <p>
            רק דמיינו זירת מסחר חופשית בלי ניתנת למעקב או עיקולים ולמעשה עצמאית לחלוטין, התוכן שלכם יכול להיות כאן!
          </p>
        </section>

        <div class="mt-4 rounded-xl bg-blue-50 p-4 text-blue-900">
          💡 כל תרומה לקידום שיפור יוקר המחיה והתנאים בארצנו תזכה במוצרים יחודיים לחברינו 🎁
        </div>
      </section>

      <!-- בלוק תמיכה/תשלום -->
      <section class="p-5 sm:p-6 rounded-3xl bg-white shadow-xl md:sticky md:top-6">
        <div class="flex items-center justify-between gap-3">
          <h2 class="text-2xl font-bold">תמכו ביוצר</h2>
          <!-- כפתור התחברות/התנתקות של TON Connect (לזיהוי בלבד) -->
          <div id="ton-connect"></div>
        </div>

        <div class="mt-4">
          <label class="block text-sm text-gray-600 mb-1">סכום התרומה (TON)</label>
          <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
            <input id="amount" type="number" step="0.01" min="0"
                   class="w-full sm:w-40 px-3 py-2 rounded-xl border border-gray-200 focus:outline-none focus:ring focus:border-blue-400"
                   value="1" />
            <!-- נשאר רק טלגרם -->
            <button id="payWithTelegram"
                    class="w-full sm:w-auto px-4 py-2 rounded-xl border hover:bg-gray-50 transition">
              לבוט טלגרם שלנו
            </button>
            <!-- כפתור לפתיחת/הורדת ארנק (טעינה/התקנה) -->
            <button id="openWallet"
                    class="w-full sm:w-auto px-4 py-2 rounded-xl border bg-white hover:bg-gray-50 transition">
              מעבר לארנק טון
            </button>
          </div>
        </div>

        <!-- בונוס לאחר תרומה (MVP) -->
        <div class="mt-6 rounded-xl bg-green-50 p-4 text-green-900 hidden" id="unlockedBox">
          ✅ תודה על תרומתכם! התוכן נחשף: <a href="#" class="underline">הורדת קובץ/קישור בונוס</a>
        </div>

        <div class="mt-4 text-right">
          <button id="unlockBtn"
                  class="w-full sm:w-auto px-4 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700 transition">
            כבר תרמתי — פתח בונוס
          </button>
          <div class="mt-2 text-xs text-gray-500" id="tc-status">לא מחובר</div>
        </div>
      </section>
    </div>

    <!-- בלוק קהילה -->
    <section class="mt-8 p-5 sm:p-6 rounded-3xl bg-white/70 glass shadow-lg">
      <h2 class="text-2xl font-extrabold mb-2">הצטרפו לקהילה בטלגרם</h2>
      <p class="text-gray-700">התייעצו, קבלו עדכונים, ושאלות על תשלומי TON לעסק.</p>
      <a id="communityLinkBottom"
         class="mt-4 inline-block px-5 py-3 rounded-2xl bg-blue-600 text-white hover:bg-blue-700 shadow">
        מעבר לקהילה
      </a>
    </section>

    <footer class="py-10 text-center text-gray-500">
      פרויקט זה נבנה על רשת טלגרם המיוצגת על ידי מטבע TON תנועת אחדות 🚀
    </footer>
  </main>

  <!-- === קונפיג מה-API === -->
  <script>
    const API_BASE = 'https://ton-2eg2.onrender.com';

    async function loadConfig() {
      const res = await fetch(API_BASE + '/config', { cache: 'no-store' });
      return res.json();
    }
    function saveUnlocked(){ localStorage.setItem('unlocked','1'); }
    function isUnlocked(){ return localStorage.getItem('unlocked')==='1'; }
    function showUnlocked(){ document.getElementById('unlockedBox').classList.remove('hidden'); }

    (async () => {
      const cfg = await loadConfig();
      window.__cfg = cfg;

      const amountEl = document.getElementById('amount');
      const unlockBtn= document.getElementById('unlockBtn');
      const commTop  = document.getElementById('communityLinkTop');
      const commBot  = document.getElementById('communityLinkBottom');

      amountEl.value = cfg.minDonationTon ?? 1;

      // קישורי קהילה/בוט
      const botOrCommunity = (cfg.botLink || cfg.communityLink || '').trim();
      if (commTop) commTop.href = cfg.communityLink || botOrCommunity;
      if (commBot) commBot.href = cfg.communityLink || botOrCommunity;

      // פתיחת הבונוס ידנית (MVP)
      unlockBtn.onclick = () => { if (isUnlocked()) showUnlocked(); else alert('הבונוס נפתח אחרי תרומה (MVP).'); };
      if (isUnlocked()) showUnlocked();
    })().catch(e => { console.error(e); alert('שגיאה בטעינת קונפיג.'); });
  </script>

  <!-- === UI לוגיקה: טלגרם + ארנק (ללא תשלום בארנק) === -->
  <script type="module">
    // סטטוס חיבור לארנק (למי שמתחבר)
    const statusEl = document.getElementById('tc-status');
    const amountInput  = document.getElementById('amount');
    const tgBtn    = document.getElementById('payWithTelegram');
    const openWalletBtn = document.getElementById('openWallet');

    // עדכון סטטוס חיבור (אופציונלי)
    const tc = window.__tonConnectUI;
    tc.onStatusChange((w) => {
      if (w?.account?.address) {
        const a = w.account.address;
        statusEl.textContent = `מחובר: ${a.slice(0,6)}…${a.slice(-4)}`;
      } else {
        statusEl.textContent = 'לא מחובר';
      }
    });

    // תשלום באמצעות טלגרם (בוט אם יש, אחרת קהילה)
    tgBtn.addEventListener('click', () => {
      const cfg = window.__cfg || {};
      const amt = parseFloat(amountInput.value) || (cfg.minDonationTon || 1);
      const base = (cfg.botLink || cfg.communityLink || '').trim();

      if (!base) { alert('לא הוגדר קישור טלגרם (bot/community) ב-API'); return; }

      const url = base.startsWith('https://t.me/')
        ? `${base}${base.includes('?') ? '&' : '?'}start=donate_${encodeURIComponent(amt)}`
        : base;

      window.location.href = url;
    });

    // מעבר לארנק טון (מסך הורדה/פתיחה של Tonkeeper – ינתב לפי המכשיר)
    openWalletBtn.addEventListener('click', () => {
      window.open('https://tonkeeper.com', '_blank', 'noopener');
    });
  </script>
</body>
</html>
